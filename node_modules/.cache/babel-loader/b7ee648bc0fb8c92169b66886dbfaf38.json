{"ast":null,"code":"var _jsxFileName = \"/home/eke/patient-eth/src/CreatePatientForm.js\";\nimport React, { useState } from 'react';\nimport './App.scss';\nimport useForm from './useForm';\nimport validate from './validateRegister';\nimport { default as Web3 } from 'web3';\nimport ipfs from './ipfs';\nimport contract from 'truffle-contract';\nimport { ethers } from 'ethers';\nimport patientindex_artifacts from './abi/PatientIndex'; // window.$ = window.jQuery = jQuery;\n\nconst CreatePatientForm = props => {\n  const INITIAL_STATE = {\n    username: \"\",\n    password: \"\",\n    fname: \"\",\n    surname: \"\",\n    email: \"\",\n    age: \"\",\n    sex: \"\",\n    id: \"\",\n    ins: \"\",\n    ETHaddress: \"\" // IPFSaddress:\"\"\n\n  }; // const contract = require('truffle-contract');\n  // const patientIndex = contract(PatientIndex);\n\n  var Patient = contract(patientindex_artifacts);\n  var [ipfsHash, setHash] = useState('');\n  const web3 = new Web3(Web3.givenProvider || \"http://localhost:7545\");\n  const ethereum = window.ethereum;\n  const [addre, setAddre] = useState('Press Enable Ethereum!');\n  const {\n    handleSubmit,\n    handleChange,\n    values,\n    errors\n  } = useForm(submit, INITIAL_STATE, validate);\n  let accounts = web3.eth.getAccounts();\n\n  async function submit() {\n    var valuesBuffer = Buffer.from(JSON.stringify(values)); //values.ETHaddress + values.username + ipfsHash\n\n    Patient.setProvider(web3.currentProvider);\n    var usnameByte32 = ethers.utils.formatBytes32String(values.username);\n    web3.eth.defaultAccount = accounts[0];\n    await ipfs.add(valuesBuffer, (error, result) => {\n      if (error) {\n        console.error(error);\n        return;\n      }\n\n      console.log(result[0].hash);\n      Patient.deployed().then(function (contractInstance) {\n        contractInstance.registerPatient(usnameByte32, Buffer.from(result[0].hash), {\n          gas: 30000,\n          from: ethereum.selectedAddress\n        }).then(function (success) {\n          if (success) {\n            console.log(\"created user on ethereum!\");\n          } else {\n            console.log(\"error creating user on ethereum!\");\n          }\n        });\n      }).catch(function (e) {\n        // There was an error! Handle it.\n        console.log('error creating user:', values.username, ':', e);\n      });\n    });\n    console.log(\"submitted successfully\"); //     const a = Patient.deployed().then(function(contractInstance){\n    //       contractInstance.getIpfsHashByPatientName(usnameByte32).then(console.log(a))\n    //     });\n  }\n\n  const ethereumButton = () => {\n    if (ethereum) {\n      web3.eth.getAccounts((err, accounts) => {\n        if (accounts.length === 0) {\n          // there is no active accounts in MetaMask\n          this.console.log('there is no active accounts in MetaMask');\n        } else {\n          // It's ok\n          web3.eth.getAccounts(console.log);\n          ethereum.on('accountsChanged', function (accounts) {\n            console.log(ethereum.selectedAddress);\n            INITIAL_STATE.ETHaddress = ethereum.selectedAddress;\n          });\n        }\n      });\n    }\n\n    ethereum.on('accountsChanged', function (accounts) {\n      setAddre(ethereum.selectedAddress);\n      INITIAL_STATE.ETHaddress = ethereum.selectedAddress;\n    });\n    setAddre(ethereum.selectedAddress);\n    INITIAL_STATE.ETHaddress = ethereum.selectedAddress;\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    class: \"col-lg-3 mt-1 mb-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 1\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"card card-profile-signup p-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 1\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    className: \"formbase\",\n    noValidate: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"card-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h5\", {\n    class: \"card-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }\n  }, \"Create your profile\"), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    for: \"username\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 9\n    }\n  }, \"Username\"), /*#__PURE__*/React.createElement(\"input\", {\n    name: \"username\",\n    value: values.username,\n    type: \"text\",\n    class: \"form-control\",\n    id: \"sign-up-username\",\n    required: \"required\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }), errors.username && /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 29\n    }\n  }, errors.username)), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    for: \"password\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 9\n    }\n  }, \"Password\"), /*#__PURE__*/React.createElement(\"input\", {\n    name: \"password\",\n    value: values.password,\n    type: \"password\",\n    class: \"form-control\",\n    id: \"sign-up-password\",\n    required: \"required\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 9\n    }\n  }), errors.password && /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 29\n    }\n  }, errors.password)), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    for: \"name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 9\n    }\n  }, \"First Name\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    name: \"fname\",\n    value: values.fname,\n    class: \"form-control\",\n    id: \"sign-up-name\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    for: \"surname\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 9\n    }\n  }, \"Surname\"), /*#__PURE__*/React.createElement(\"input\", {\n    name: \"surname\",\n    value: values.surname,\n    type: \"text\",\n    class: \"form-control\",\n    id: \"sign-up-srname\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    for: \"email\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }\n  }, \"Email\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"email\",\n    value: values.email,\n    name: \"email\",\n    class: \"form-control\",\n    id: \"sign-up-email\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    for: \"age\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 9\n    }\n  }, \"Age\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    value: values.age,\n    name: \"age\",\n    class: \"form-control\",\n    id: \"sign-up-age\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    for: \"sex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 9\n    }\n  }, \"Sex\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    value: values.sex,\n    name: \"sex\",\n    class: \"form-control\",\n    id: \"sign-up-sex\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    for: \"id\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 9\n    }\n  }, \"Identity No.\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    value: values.id,\n    name: \"id\",\n    class: \"form-control\",\n    id: \"sign-up-idno\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"form-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    for: \"ins\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 9\n    }\n  }, \"Insurance No.\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    name: \"ins\",\n    value: values.ins,\n    class: \"form-control\",\n    id: \"sign-up-insno\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 7\n    }\n  }, \"ETH Address:\", /*#__PURE__*/React.createElement(\"span\", {\n    class: \"eth-address\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    name: \"ethaddress\",\n    class: \"form-control\",\n    id: \"sign-up-eth-address\",\n    value: addre,\n    disabled: true,\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    class: \"btn btn-primary\",\n    id: \"sign-up-button\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }\n  }, \"Sign Up\"))), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: ethereumButton,\n    class: \"enableEthereumButton\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 3\n    }\n  }, \"Enable Ethereum\")));\n};\n\nexport default CreatePatientForm;","map":{"version":3,"sources":["/home/eke/patient-eth/src/CreatePatientForm.js"],"names":["React","useState","useForm","validate","default","Web3","ipfs","contract","ethers","patientindex_artifacts","CreatePatientForm","props","INITIAL_STATE","username","password","fname","surname","email","age","sex","id","ins","ETHaddress","Patient","ipfsHash","setHash","web3","givenProvider","ethereum","window","addre","setAddre","handleSubmit","handleChange","values","errors","submit","accounts","eth","getAccounts","valuesBuffer","Buffer","from","JSON","stringify","setProvider","currentProvider","usnameByte32","utils","formatBytes32String","defaultAccount","add","error","result","console","log","hash","deployed","then","contractInstance","registerPatient","gas","selectedAddress","success","catch","e","ethereumButton","err","length","on"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport './App.scss';\nimport useForm from './useForm';\nimport validate from './validateRegister';\nimport {default as Web3} from 'web3';\nimport ipfs from './ipfs';\nimport contract from 'truffle-contract';\nimport {ethers} from 'ethers';\nimport patientindex_artifacts from './abi/PatientIndex'\n\n// window.$ = window.jQuery = jQuery;\n\nconst CreatePatientForm = (props) => {\n  const INITIAL_STATE = {\n    username: \"\",\n    password: \"\",\n    fname:\"\",\n    surname:\"\",\n    email:\"\",\n    age:\"\",\n    sex:\"\",\n    id:\"\",\n    ins:\"\",\n    ETHaddress:\"\"\n    // IPFSaddress:\"\"\n  }\n\n  // const contract = require('truffle-contract');\n  // const patientIndex = contract(PatientIndex);\n  var Patient = contract(patientindex_artifacts);\n\n  var [ipfsHash,setHash] = useState('');\n\n  const web3 = new Web3(Web3.givenProvider || \"http://localhost:7545\" );\n  const ethereum = window.ethereum;\n  const [addre,setAddre] = useState('Press Enable Ethereum!')\n  const {handleSubmit, handleChange, values, errors} = useForm(submit,INITIAL_STATE,validate);\n  let accounts = web3.eth.getAccounts();\n \n\n  async function submit() {\n    var valuesBuffer = Buffer.from(JSON.stringify(values)); //values.ETHaddress + values.username + ipfsHash\n    Patient.setProvider(web3.currentProvider);\n    var usnameByte32 = ethers.utils.formatBytes32String(values.username);\n    web3.eth.defaultAccount = accounts[0]\n\n    await ipfs.add(valuesBuffer, (error, result) =>{\n      if(error){\n        console.error(error)\n        return\n      }\n      console.log(result[0].hash)\n      Patient.deployed().then(function(contractInstance){\n        contractInstance.registerPatient(usnameByte32, Buffer.from(result[0].hash),{gas: 30000 ,from: ethereum.selectedAddress}).then(function(success){\n          if(success){\n          console.log(\"created user on ethereum!\");\n          }else{\n            console.log(\"error creating user on ethereum!\");\n          }\n        });\n      }).catch(function(e) {\n        // There was an error! Handle it.\n        console.log('error creating user:', values.username, ':', e);\n      });\n    })\n      console.log(\"submitted successfully\")\n  //     const a = Patient.deployed().then(function(contractInstance){\n  //       contractInstance.getIpfsHashByPatientName(usnameByte32).then(console.log(a))\n  //     });\n  }\n\n\n\n const ethereumButton = () => {\n  if(ethereum){\n    web3.eth.getAccounts((err, accounts) => {\n      if (accounts.length === 0) {\n        // there is no active accounts in MetaMask\n        this.console.log('there is no active accounts in MetaMask')\n      }else {\n        // It's ok\n          web3.eth.getAccounts(console.log);\n          ethereum.on('accountsChanged',function(accounts){\n          console.log(ethereum.selectedAddress)\n          INITIAL_STATE.ETHaddress = ethereum.selectedAddress\n        });\n        }\n      });\n    }\n    ethereum.on('accountsChanged',function(accounts){\n      setAddre(ethereum.selectedAddress)\n      INITIAL_STATE.ETHaddress = ethereum.selectedAddress\n    });\n    setAddre(ethereum.selectedAddress)\n    INITIAL_STATE.ETHaddress = ethereum.selectedAddress\n  }\n\nreturn(\n<div class=\"col-lg-3 mt-1 mb-1\">\n<div class=\"card card-profile-signup p-1\">\n  <form onSubmit={handleSubmit} className='formbase' noValidate>\n    <div class=\"card-body\">\n      <h5 class=\"card-title\">Create your profile</h5>\n      <div class=\"form-group\">\n        <label for=\"username\">Username</label>\n        <input name=\"username\"\n               value={values.username}\n               type=\"text\" \n               class=\"form-control\" \n               id=\"sign-up-username\" \n               required=\"required\"\n               onChange={handleChange}\n        />\n        {errors.username && <p>{errors.username}</p>}\n      </div>\n      <div class=\"form-group\">\n        <label for=\"password\">Password</label>\n        <input name=\"password\"\n               value={values.password}\n               type=\"password\" \n               class=\"form-control\" \n               id=\"sign-up-password\" \n               required=\"required\"\n               onChange={handleChange}\n        />\n        {errors.password && <p>{errors.password}</p>}\n      </div>\n      <div class=\"form-group\">\n        <label for=\"name\">First Name</label>\n        <input type=\"text\" \n               name=\"fname\"\n               value={values.fname}\n               class=\"form-control\" \n               id=\"sign-up-name\"\n               onChange={handleChange}\n        />\n      </div>\n      <div class=\"form-group\">\n        <label for=\"surname\">Surname</label>\n        <input name=\"surname\"\n               value={values.surname}\n               type=\"text\" class=\"form-control\" \n               id=\"sign-up-srname\"\n               onChange={handleChange}\n        />\n      </div>\n      <div class=\"form-group\">\n        <label for=\"email\">Email</label>\n        <input type=\"email\" \n               value={values.email}\n               name=\"email\" \n               class=\"form-control\" \n               id=\"sign-up-email\"\n               onChange={handleChange}\n               \n        />\n      </div>\n      <div class=\"form-group\">\n        <label for=\"age\">Age</label>\n        <input type=\"text\"\n               value={values.age}\n               name=\"age\" class=\"form-control\" \n               id=\"sign-up-age\"\n               onChange={handleChange}\n        />\n      </div>\n      <div class=\"form-group\">\n        <label for=\"sex\">Sex</label>\n        <input type=\"text\"\n               value={values.sex}\n               name=\"sex\" \n               class=\"form-control\" \n               id=\"sign-up-sex\"\n               onChange={handleChange}\n        />\n      </div>\n      <div class=\"form-group\">\n        <label for=\"id\">Identity No.</label>\n        <input type=\"text\"\n               value={values.id}\n               name=\"id\" class=\"form-control\" \n               id=\"sign-up-idno\"\n               onChange={handleChange}\n        />\n      </div>\n      <div class=\"form-group\">\n        <label for=\"ins\">Insurance No.</label>\n        <input type=\"text\"\n               name=\"ins\" \n               value={values.ins}\n               class=\"form-control\" \n               id=\"sign-up-insno\"\n               onChange={handleChange}\n        />\n      </div>\n      {/* <div class=\"form-group\">\n        <label for=\"username\">Short intro</label>\n        <textarea class=\"form-control\" id=\"sign-up-intro\" rows=\"2\"></textarea>\n      </div> */}\n      <p>ETH Address:\n        <span class=\"eth-address\"></span>\n        <input type=\"text\"\n               name=\"ethaddress\" \n               class=\"form-control\" id=\"sign-up-eth-address\" \n               value={addre}\n               disabled\n               onChange={handleChange}\n        />\n      </p>\n      <button type=\"submit\" class=\"btn btn-primary\" id=\"sign-up-button\">Sign Up</button>\n    </div>\n   \n  </form>\n  <button onClick={ethereumButton} class=\"enableEthereumButton\">Enable Ethereum</button>\n</div>\n</div>\n );\n}\n\nexport default CreatePatientForm;\n"]},"metadata":{},"sourceType":"module"}